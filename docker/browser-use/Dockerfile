# Browser-Use MCP Server Dockerfile
# åŸºäºå®˜æ–¹ browser-use-mcp-server æ„å»ºï¼Œæ·»åŠ  VNC æ”¯æŒå’Œ Cookie æŒä¹…åŒ–

FROM docker.m.daocloud.io/library/python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ğŸš€ ä½¿ç”¨æ¸…åå¤§å­¦ TUNA é•œåƒæºåŠ é€Ÿ apt ä¸‹è½½
RUN sed -i 's|deb.debian.org|mirrors.tuna.tsinghua.edu.cn|g' /etc/apt/sources.list.d/debian.sources && \
    sed -i 's|security.debian.org|mirrors.tuna.tsinghua.edu.cn|g' /etc/apt/sources.list.d/debian.sources

# ğŸš€ é…ç½® pip ä½¿ç”¨æ¸…åå¤§å­¦é•œåƒæº
RUN pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple/ && \
    pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    # Playwright ä¾èµ–
    libnss3 \
    libnspr4 \
    libatk1.0-0 \
    libatk-bridge2.0-0 \
    libcups2 \
    libdrm2 \
    libxkbcommon0 \
    libxcomposite1 \
    libxdamage1 \
    libxfixes3 \
    libxrandr2 \
    libgbm1 \
    libasound2 \
    libpango-1.0-0 \
    libcairo2 \
    # VNC ç›¸å…³
    x11vnc \
    xvfb \
    fluxbox \
    # å·¥å…·
    curl \
    git \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£… uv (å¿«é€Ÿ Python åŒ…ç®¡ç†å™¨)
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.local/bin:$PATH"

# å®‰è£… mcp-server-browser-use (æ­£ç¡®çš„åŒ…å)
RUN uv pip install --system mcp-server-browser-use

# å®‰è£… Playwright æµè§ˆå™¨
RUN uv pip install --system playwright && \
    playwright install chromium && \
    playwright install-deps chromium

# åˆ›å»ºæµè§ˆå™¨æ•°æ®ç›®å½•
RUN mkdir -p /app/browser-data

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV DISPLAY=:99
ENV BROWSER_DATA_DIR=/app/browser-data

# VNC å¯åŠ¨è„šæœ¬
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# æš´éœ²ç«¯å£
# 8000: MCP Server (SSE)
# 5900: VNC
EXPOSE 8000 5900

ENTRYPOINT ["/entrypoint.sh"]
