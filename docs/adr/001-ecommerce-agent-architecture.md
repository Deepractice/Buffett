# ADR-001: ç”µå•†æ™ºèƒ½åŠ©æ‰‹å¹³å°æ¶æ„è®¾è®¡

> çŠ¶æ€ï¼šå·²é‡‡çº³
> æ—¥æœŸï¼š2025-12-16 (v2 é‡æ„)
> å†³ç­–è€…ï¼šSean, yejh0725

---

## 1. æ¦‚è¿°

### 1.1 äº§å“å®šä½

ç”µå•†æ™ºèƒ½åŠ©æ‰‹å¹³å°ï¼Œä¸ºæœè£…ç”µå•†å•†å®¶æä¾› AI é©±åŠ¨çš„è¿è¥å·¥å…·é›†ã€‚

### 1.2 ç›®æ ‡ç”¨æˆ·

- å†…éƒ¨ç”¨æˆ·ï¼š15-20 äºº
- è§’è‰²ï¼šç”µå•†è¿è¥ã€è®¾è®¡å¸ˆã€å†…å®¹åˆ›ä½œè€…

### 1.3 æ ¸å¿ƒåŠŸèƒ½

| æ™ºèƒ½ä½“ | èŒè´£ | æ ¸å¿ƒèƒ½åŠ› |
|--------|------|----------|
| å† å | æ¢å›¾åŠ©æ‰‹ | å•†å“å›¾æ¢èƒŒæ™¯ã€æ¢æ¨¡ç‰¹ã€å¹³å°é€‚é… |
| æ—¶å°šCEO | æˆ˜ç•¥é¡¾é—® | å“ç‰Œå®šä½ã€å¸‚åœºåˆ†æã€ç»è¥å†³ç­– |
| å‰ªè¾‘å¤§å¸ˆ | è§†é¢‘åˆ¶ä½œ | çŸ­è§†é¢‘è„šæœ¬ã€å‰ªè¾‘å»ºè®®ã€å†…å®¹ç­–åˆ’ |
| ç§è‰è¾¾äºº | å°çº¢ä¹¦ä½œè€… | çˆ†æ¬¾æ–‡æ¡ˆã€ç§è‰ç¬”è®°ã€æ ‡é¢˜ä¼˜åŒ– |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å‰ç«¯ (React SPA)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚           â”‚                                                 â”‚â”‚
â”‚  â”‚  å¯¹è¯åˆ—è¡¨ â”‚                   å¯¹è¯åŒº                        â”‚â”‚
â”‚  â”‚  (ä¾§è¾¹æ ) â”‚                                                 â”‚â”‚
â”‚  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚ [+æ–°å»º]   â”‚  â”‚                                           â”‚  â”‚â”‚
â”‚  â”‚           â”‚  â”‚         ResponsiveStudio                  â”‚  â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚         (@agentxjs/ui)                    â”‚  â”‚â”‚
â”‚  â”‚ â”‚ğŸ¨å† å â”‚â—„â”¤  â”‚                                           â”‚  â”‚â”‚
â”‚  â”‚ â”‚æ¢èƒŒæ™¯..â”‚ â”‚  â”‚  - æ¶ˆæ¯æ¸²æŸ“                               â”‚  â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  - è¾“å…¥æ¡†                                 â”‚  â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  - å›¾ç‰‡ä¸Šä¼                                â”‚  â”‚â”‚
â”‚  â”‚ â”‚ğŸ‘”æ—¶å°š â”‚ â”‚  â”‚  - ç§»åŠ¨ç«¯é€‚é…                             â”‚  â”‚â”‚
â”‚  â”‚ â”‚CEO   â”‚ â”‚  â”‚                                           â”‚  â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚           â”‚                                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  è·¯ç”±: / (ç™»å½•) â†’ /app (ä¸»ç•Œé¢)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ WebSocket (ws://host:5800)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AgentX Server                              â”‚
â”‚                      (Node.js + Docker)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Container Manager                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Container: user1                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€â”€ Image: img_xxx {agentType: "guanhua"}           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€â”€ Image: img_yyy {agentType: "fashion-ceo"}       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€â”€ Image: img_zzz {agentType: "video-master"}      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Container: user2                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€â”€ ...                                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Agent Registry                          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ GuanhuaAgent          (æ¢å›¾åŠ©æ‰‹)                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ FashionCEOAgent       (æœè£…CEO)                       â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ VideoMasterAgent      (å‰ªè¾‘å¤§å¸ˆ)                      â”‚  â”‚
â”‚  â”‚  â””â”€â”€ XiaohongshuWriterAgent (ç§è‰è¾¾äºº)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ MCP Protocol
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PromptX MCP Server                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚vision-      â”‚ â”‚prompt-      â”‚ â”‚image-       â”‚ â”‚filesystem â”‚  â”‚
â”‚  â”‚analyzer     â”‚ â”‚assembler    â”‚ â”‚generator    â”‚ â”‚           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| å‰ç«¯ | React + TypeScript | SPA å•é¡µåº”ç”¨ |
| UIç»„ä»¶ | @agentxjs/ui | ResponsiveStudio å¯¹è¯ç»„ä»¶ |
| æ ·å¼ | Tailwind CSS | åŸå­åŒ– CSS |
| æ„å»º | Vite | å¿«é€Ÿå¼€å‘æ„å»º |
| åç«¯ | AgentX (Node.js) | æ™ºèƒ½ä½“è¿è¡Œæ—¶ |
| é€šä¿¡ | WebSocket | å®æ—¶åŒå‘é€šä¿¡ |
| AI | Claude (Anthropic) | å¤§è¯­è¨€æ¨¡å‹ |
| å·¥å…· | PromptX MCP | å›¾åƒç”Ÿæˆã€åˆ†æç­‰å·¥å…· |
| éƒ¨ç½² | Docker (å•æœº) | å®¹å™¨åŒ–éƒ¨ç½² |

---

## 3. æ ¸å¿ƒè®¾è®¡

### 3.1 ç”¨æˆ·è®¤è¯

#### 3.1.1 è®¤è¯æ–¹å¼

é‡‡ç”¨**é¢„è®¾è´¦æˆ· + å‰ç«¯éªŒè¯**çš„ç®€åŒ–æ–¹æ¡ˆï¼š

```typescript
// é¢„è®¾è´¦æˆ·ï¼ˆå‰ç«¯å­˜å‚¨ï¼‰
const PRESET_USERS: Record<string, string> = {
  "admin": "admin123",
  "user1": "pass001",
  "user2": "pass002",
  // ... å…± 15-20 ä¸ªè´¦æˆ·
};
```

#### 3.1.2 ä¼šè¯ç®¡ç†

```
ç™»å½•æµç¨‹:
1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·å/å¯†ç 
2. å‰ç«¯éªŒè¯ PRESET_USERS
3. éªŒè¯é€šè¿‡ â†’ localStorage å­˜å‚¨ userId + authToken
4. è·³è½¬ä¸»ç•Œé¢

ä¼šè¯æ¢å¤:
1. é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ localStorage
2. æœ‰ userId + authToken â†’ ç›´æ¥è¿›å…¥ä¸»ç•Œé¢
3. æ—  â†’ è·³è½¬ç™»å½•é¡µ

ç™»å‡º:
1. æ¸…é™¤ localStorage
2. è·³è½¬ç™»å½•é¡µ
```

#### 3.1.3 æ•°æ®ç»“æ„

```typescript
// localStorage å­˜å‚¨
{
  "userId": "user1",
  "authToken": "base64(userId:timestamp)"
}
```

### 3.2 ç”¨æˆ·éš”ç¦»

#### 3.2.1 Container æ¨¡å‹

æ¯ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ Containerï¼š

```
Container (ç”¨æˆ·çº§åˆ«)
â”œâ”€â”€ userId: "user1"
â”œâ”€â”€ images: [              // å¯¹è¯åˆ—è¡¨
â”‚   {
â”‚     imageId: "img_xxx",
â”‚     name: "æ¢èƒŒæ™¯å’¨è¯¢",
â”‚     metadata: {
â”‚       agentType: "guanhua"  // ç»‘å®šçš„æ™ºèƒ½ä½“
â”‚     },
â”‚     messages: [...]
â”‚   },
â”‚   {
â”‚     imageId: "img_yyy",
â”‚     name: "å“ç‰Œå®šä½è®¨è®º",
â”‚     metadata: {
â”‚       agentType: "fashion-ceo"
â”‚     },
â”‚     messages: [...]
â”‚   }
â”‚ ]
â””â”€â”€ workdirs/              // å·¥ä½œç›®å½•ï¼ˆå›¾ç‰‡ç­‰ï¼‰
```

#### 3.2.2 éš”ç¦»ç­–ç•¥

| èµ„æº | éš”ç¦»æ–¹å¼ | è¯´æ˜ |
|------|----------|------|
| å¯¹è¯å†å² | Container | æ¯ç”¨æˆ·ç‹¬ç«‹ Container |
| ç”Ÿæˆå›¾ç‰‡ | æ–‡ä»¶ç³»ç»Ÿ | `/uploads/{userId}/` |
| MCP å·¥å…· | å…±äº« | æ‰€æœ‰ç”¨æˆ·å…±äº« PromptX |

### 3.3 å¯¹è¯ä¸æ™ºèƒ½ä½“ç»‘å®š

#### 3.3.1 è®¾è®¡ç†å¿µ

**ç±»å¾®ä¿¡ä½“éªŒ**ï¼š
- å¯¹è¯ = è”ç³»äººï¼ˆæ™ºèƒ½ä½“ï¼‰+ èŠå¤©è®°å½•
- åˆ›å»ºå¯¹è¯æ—¶é€‰æ‹©æ™ºèƒ½ä½“ï¼Œä¹‹åä¸å¯æ›´æ¢
- åˆ‡æ¢æ™ºèƒ½ä½“ = åˆ›å»ºæ–°å¯¹è¯

#### 3.3.2 ç»‘å®šæœºåˆ¶

é€šè¿‡ Image çš„ `metadata.agentType` å­˜å‚¨æ™ºèƒ½ä½“ç±»å‹ï¼š

```typescript
// åˆ›å»ºæ–°å¯¹è¯
await agentx.request("image_create_request", {
  containerId: userId,
  name: "æ–°å¯¹è¯",
  metadata: {
    agentType: "guanhua"  // ç»‘å®šæ™ºèƒ½ä½“
  }
});

// å‘é€æ¶ˆæ¯æ—¶ï¼Œæ ¹æ® agentType åŠ è½½å¯¹åº” Agent
const agent = getAgentById(image.metadata.agentType);
```

#### 3.3.3 æ™ºèƒ½ä½“æ³¨å†Œè¡¨

```typescript
// src/agent.ts
export const AGENTS_MAP = {
  "guanhua": GuanhuaAgent,
  "fashion-ceo": FashionCEOAgent,
  "video-master": VideoMasterAgent,
  "xiaohongshu-writer": XiaohongshuWriterAgent,
};

export function getAgentById(agentId: string) {
  return AGENTS_MAP[agentId] || GuanhuaAgent;
}
```

### 3.4 å›¾ç‰‡å­˜å‚¨

#### 3.4.1 å­˜å‚¨æ–¹æ¡ˆ

æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼ŒæŒ‰ç”¨æˆ·éš”ç¦»ï¼š

```
/uploads/
â”œâ”€â”€ user1/
â”‚   â”œâ”€â”€ img_xxx/
â”‚   â”‚   â”œâ”€â”€ original.jpg      # ç”¨æˆ·ä¸Šä¼ çš„åŸå›¾
â”‚   â”‚   â”œâ”€â”€ generated_1.jpg   # AI ç”Ÿæˆçš„å›¾ç‰‡
â”‚   â”‚   â””â”€â”€ generated_2.jpg
â”‚   â””â”€â”€ img_yyy/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ user2/
â”‚   â””â”€â”€ ...
```

#### 3.4.2 ç”Ÿå‘½å‘¨æœŸ

- **åˆ›å»º**ï¼šå¯¹è¯ä¸­ä¸Šä¼ /ç”Ÿæˆå›¾ç‰‡æ—¶åˆ›å»º
- **ä¿ç•™**ï¼šå¯¹è¯å­˜åœ¨æœŸé—´ä¿ç•™
- **æ¸…ç†**ï¼šåˆ é™¤å¯¹è¯æ—¶å¯é€‰æ‹©æ¸…ç†å…³è”å›¾ç‰‡

### 3.5 æ•°æ®æŒä¹…åŒ–

#### 3.5.1 å­˜å‚¨ä»‹è´¨

| æ•°æ®ç±»å‹ | å­˜å‚¨æ–¹å¼ | ä½ç½® |
|----------|----------|------|
| ç”¨æˆ·è´¦æˆ· | å‰ç«¯ç¡¬ç¼–ç  | App.tsx |
| ä¼šè¯çŠ¶æ€ | localStorage | æµè§ˆå™¨ |
| å¯¹è¯å†å² | SQLite | .agentx/db/ |
| ç”Ÿæˆå›¾ç‰‡ | æ–‡ä»¶ç³»ç»Ÿ | /uploads/ |

#### 3.5.2 æ¸…ç†ç­–ç•¥

- å¯¹è¯å†å²ï¼šåˆ é™¤å¯¹è¯æ—¶æ¸…ç†
- ç”Ÿæˆå›¾ç‰‡ï¼šè·Ÿéšå¯¹è¯ç”Ÿå‘½å‘¨æœŸ
- æš‚ä¸è€ƒè™‘é•¿æœŸå½’æ¡£

---

## 4. å‰ç«¯æ¶æ„

### 4.1 é¡µé¢ç»“æ„

```
App
â”œâ”€â”€ LoginPage          # ç™»å½•é¡µ
â”‚   â””â”€â”€ é¢„è®¾è´¦æˆ·éªŒè¯
â”‚
â””â”€â”€ MainPage           # ä¸»ç•Œé¢ (ç™»å½•å)
    â”œâ”€â”€ Sidebar        # å·¦ä¾§è¾¹æ 
    â”‚   â”œâ”€â”€ UserInfo   # ç”¨æˆ·ä¿¡æ¯ + ç™»å‡º
    â”‚   â”œâ”€â”€ NewChat    # æ–°å»ºå¯¹è¯æŒ‰é’®
    â”‚   â””â”€â”€ ChatList   # å¯¹è¯åˆ—è¡¨
    â”‚       â””â”€â”€ ChatItem (æ™ºèƒ½ä½“å›¾æ ‡ + åç§° + é¢„è§ˆ)
    â”‚
    â””â”€â”€ ChatArea       # å³ä¾§å¯¹è¯åŒº
        â””â”€â”€ ResponsiveStudio (@agentxjs/ui)
```

### 4.2 çŠ¶æ€ç®¡ç†

```typescript
// App çº§åˆ«çŠ¶æ€
const [userId, setUserId] = useState<string | null>(null);
const [currentImageId, setCurrentImageId] = useState<string | null>(null);

// å¯¹è¯åˆ—è¡¨ä» AgentX è·å–
const images = useAgentXImages(containerId);
```

### 4.3 ç§»åŠ¨ç«¯é€‚é…

ä¾èµ– `@agentxjs/ui` çš„ ResponsiveStudio ç»„ä»¶ï¼š
- è‡ªåŠ¨å“åº”å¼å¸ƒå±€
- ç§»åŠ¨ç«¯ä¼˜åŒ–çš„è¾“å…¥ä½“éªŒ
- å›¾ç‰‡ä¸Šä¼ é€‚é…

ä¾§è¾¹æ é€‚é…ï¼š
- æ¡Œé¢ç«¯ï¼šå›ºå®šæ˜¾ç¤º
- ç§»åŠ¨ç«¯ï¼šæŠ½å±‰æ¨¡å¼ï¼ˆç‚¹å‡»æ±‰å ¡èœå•å±•å¼€ï¼‰

---

## 5. åç«¯æ¶æ„

### 5.1 æœåŠ¡ç»„æˆ

```
AgentX Server (å•è¿›ç¨‹)
â”œâ”€â”€ WebSocket Server (:5800)    # ä¸»æœåŠ¡
â”œâ”€â”€ Vision API (:5801)          # å›¾ç‰‡åˆ†æ HTTP API
â””â”€â”€ Static Server (:80)         # ç”Ÿäº§ç¯å¢ƒé™æ€æ–‡ä»¶
```

### 5.2 æ ¸å¿ƒæ¨¡å—

```typescript
// src/server.ts
async function startServer() {
  // 1. åˆ›å»º AgentX å®ä¾‹
  const agentx = await createAgentX({
    llm: { apiKey, model },
    defaultAgent: GuanhuaAgent,  // é»˜è®¤æ™ºèƒ½ä½“
  });

  // 2. Container æŒ‰éœ€åˆ›å»ºï¼ˆç”¨æˆ·é¦–æ¬¡è¿æ¥æ—¶ï¼‰
  // ç”± @agentxjs/ui è‡ªåŠ¨å¤„ç†

  // 3. å¯åŠ¨ WebSocket æœåŠ¡
  await agentx.listen(5800);
}
```

### 5.3 æ™ºèƒ½ä½“åŠ è½½

```
æ¶ˆæ¯å¤„ç†æµç¨‹:
1. å‰ç«¯å‘é€æ¶ˆæ¯ â†’ WebSocket â†’ AgentX
2. AgentX æŸ¥æ‰¾ Image â†’ è·å– metadata.agentType
3. åŠ è½½å¯¹åº” Agent çš„ systemPrompt
4. è°ƒç”¨ Claude API
5. è¿”å›å“åº” â†’ å‰ç«¯æ¸²æŸ“
```

---

## 6. éƒ¨ç½²æ¶æ„

### 6.1 éƒ¨ç½²æ–¹å¼

**å•æœº Docker éƒ¨ç½²**ï¼ˆB/S æ¶æ„ï¼‰ï¼š

```yaml
# docker-compose.yml
version: '3.8'
services:
  ecommerce-agent:
    build: .
    ports:
      - "80:80"      # HTTP (ç”Ÿäº§)
      - "5800:5800"  # WebSocket
      - "5801:5801"  # Vision API
    volumes:
      - ./uploads:/app/uploads      # å›¾ç‰‡å­˜å‚¨
      - ./.agentx:/app/.agentx      # AgentX æ•°æ®
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - NODE_ENV=production
```

### 6.2 ç½‘ç»œæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP/WS      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Docker å®¹å™¨    â”‚
â”‚  (å¤šç”¨æˆ·)    â”‚                  â”‚  (å•å®ä¾‹)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ HTTPS
                                        â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚  Anthropic API  â”‚
                                 â”‚  (Claude)       â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. å·¥ä½œæµè®¾è®¡

### 7.1 æ¢å›¾å·¥ä½œæµ (å† å)

```
ç”¨æˆ·ä¸Šä¼ å•†å“å›¾
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vision-analyzer â”‚  åˆ†æåŸå›¾ï¼šæœè£…æ¬¾å¼ã€é¢œè‰²ã€æè´¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ prompt-assemblerâ”‚  ç»„è£…æç¤ºè¯ï¼šåŸºäºåˆ†æç»“æœ + ç”¨æˆ·éœ€æ±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ image-generator â”‚  ç”Ÿæˆæ–°å›¾ï¼š
â”‚                 â”‚  - mode: image_to_image
â”‚                 â”‚  - edit_scope: background_only
â”‚                 â”‚  - candidateCount: 2-3
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   è¾“å‡ºå¤šå¼ å€™é€‰å›¾ä¾›é€‰æ‹©
```

### 7.2 å°çº¢ä¹¦å‘å¸ƒå·¥ä½œæµ (ç§è‰è¾¾äºº + æµè§ˆå™¨è‡ªåŠ¨åŒ–)

```
å•†å“å›¾ + å–ç‚¹
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§è‰è¾¾äºº       â”‚  ç”Ÿæˆå°çº¢ä¹¦é£æ ¼æ–‡æ¡ˆ
â”‚  (æ–‡æ¡ˆåˆ›ä½œ)     â”‚  - æ ‡é¢˜ä¼˜åŒ–
â”‚                 â”‚  - æ­£æ–‡ç»“æ„
â”‚                 â”‚  - æ ‡ç­¾æ¨è
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  browser-use    â”‚  æµè§ˆå™¨è‡ªåŠ¨åŒ–å‘å¸ƒ (Phase 2)
â”‚  (MCP Server)   â”‚  - ç™»å½•å°çº¢ä¹¦
â”‚                 â”‚  - ä¸Šä¼ å›¾ç‰‡
â”‚                 â”‚  - å‘å¸ƒç¬”è®°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   è¿”å›å‘å¸ƒé“¾æ¥
```

---

## 8. æ¼”è¿›è·¯çº¿

### Phase 1: MVP (å½“å‰)

- [x] ç”¨æˆ·ç™»å½•ï¼ˆé¢„è®¾è´¦æˆ·ï¼‰
- [x] å¤šæ™ºèƒ½ä½“å®šä¹‰
- [x] å¯¹è¯-æ™ºèƒ½ä½“ç»‘å®š
- [ ] å¯¹è¯åˆ—è¡¨ UI
- [ ] æ–°å»ºå¯¹è¯ï¼ˆé€‰æ‹©æ™ºèƒ½ä½“ï¼‰
- [ ] æœ¬åœ°å›¾ç‰‡å­˜å‚¨

### Phase 2: å¢å¼º

- [ ] æµè§ˆå™¨è‡ªåŠ¨åŒ– (browser-use MCP)
- [ ] å°çº¢ä¹¦å‘å¸ƒå·¥ä½œæµ
- [ ] å¯¹è¯å¯¼å‡º

### Phase 3: æ‰©å±• (å¯é€‰)

- [ ] åç«¯ç”¨æˆ·è®¤è¯
- [ ] æ•°æ®åº“å­˜å‚¨
- [ ] å¤šå®ä¾‹éƒ¨ç½²

---

## 9. é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| å‰ç«¯è®¤è¯ä¸å®‰å…¨ | ä¸­ | å†…éƒ¨ä½¿ç”¨ï¼Œå¯æ¥å—ï¼›Phase 3 è¿ç§»åç«¯è®¤è¯ |
| å•æœºéƒ¨ç½²ç“¶é¢ˆ | ä½ | 15-20 ç”¨æˆ·è¶³å¤Ÿï¼›Phase 3 è€ƒè™‘æ‰©å±• |
| å°çº¢ä¹¦åçˆ¬ | é«˜ | æ§åˆ¶é¢‘ç‡ï¼›ä¿ç•™æ‰‹åŠ¨å‘å¸ƒå…œåº• |
| å›¾ç‰‡å­˜å‚¨å ç”¨ | ä¸­ | å®šæœŸæ¸…ç†ï¼›å¯¹è¯åˆ é™¤æ—¶æ¸…ç†å›¾ç‰‡ |

---

## é™„å½•

### A. é¢„è®¾è´¦æˆ·åˆ—è¡¨

```typescript
const PRESET_USERS = {
  "admin": "admin123",
  "demo": "demo123",
  "user1": "pass001",
  "user2": "pass002",
  "user3": "pass003",
  "user4": "pass004",
  "user5": "pass005",
  // å¯æ‰©å±•è‡³ 20 ä¸ª
};
```

### B. æ™ºèƒ½ä½“ ID æ˜ å°„

| ID | åç§° | å›¾æ ‡ | é¢œè‰² |
|----|------|------|------|
| guanhua | å† å | ğŸ¨ | purple-pink |
| fashion-ceo | æ—¶å°šCEO | ğŸ‘” | blue-cyan |
| video-master | å‰ªè¾‘å¤§å¸ˆ | ğŸ¬ | red-orange |
| xiaohongshu-writer | ç§è‰è¾¾äºº | ğŸ“ | green-teal |

### C. ç›¸å…³æ–‡æ¡£

- [AgentX æ–‡æ¡£](https://agentx.dev)
- [PromptX å·¥å…·æ‰‹å†Œ](tool://image-generator)
- [browser-use](https://github.com/browser-use/browser-use)
